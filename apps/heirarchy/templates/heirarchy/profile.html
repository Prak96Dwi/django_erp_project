{% extends 'heirarchy/base.html' %}
{% load static %}


{% block body-content %}
 <div class="container txt-center">
  <center>
  <form method="POST" id="personForm" 
     style="margin-left:300px;margin-top: 150px; background-color: white; padding: 55px"
     data-names-url="{% url 'ajax_load_names' %}">
	   {% csrf_token %}
    <h3><b>User Heirarchy </b></h3>
    
	    <!-- <ul class="errorlist"><li>This field is required.</li></ul> -->
    <div class="row form-group">
      <div class="col-md-4 col-bg-4 col-sm-4 col-lg-4">
      <label for="id_usernm">Parent:</label>
      </div>
      <div class="col-md-8 col-bg-8 col-sm-8 col-lg-8">
        <select name="parent_id"  id="id_usernm" class="form-control form-control-sm"  
        required = "required">

          <optgroup label="Director">
          {% for member in DIR %}
            <option value="{{ member.id }}" class="dropdown-item" selected>
              {{ member.first_name }} 
            {{ member.last_name }}</option>
          {% endfor %}
          </optgroup>

          <optgroup label="Cheif Technical Officer">
          {% for member in CTO %}
            <option value="{{ member.id }}" class="dropdown-item"
            selected>{{ member.first_name }} 
            {{ member.last_name }}</option>
          {% endfor %}
          </optgroup>
          
          <optgroup label="Project Manager">
          {% for member in PM %}
            <option value="{{ member.id }}" selected class="dropdown-item">
              {{ member.first_name }} 
            {{ member.last_name }}</option>
          {% endfor %}
          </optgroup>

          <optgroup label="Tech Leader">
          {% for member in TL %}
            <option value="{{ member.id }}" class="dropdown-item" selected>
              {{ member.first_name }} 
            {{ member.last_name }}</option>
          {% endfor %}
          </optgroup>

          <optgroup label="Web Developer">
          {% for member in Web %}
            <option value="{{ member.id }}" class="dropdown-item" selected>
              {{ member.first_name }} 
            {{ member.last_name }}</option>
          {% endfor %}
          <option value="" selected>-----------</option>
          </optgroup>
        </select>
        </div>
    </div> 
    <div class="row">
      <div class="col-md-4 col-bg-4 col-sm-4 col-lg-4">
      <label for="id_child">Child:</label>
      </div>
      <div class="col-md-4 col-bg-4 col-sm-4 col-lg-4">
      <select name="child_list"  required="required" id="id_child" class="form-control" multiple>
      </select>
      </div>
    </div>
    <br>
  
    <input type="Submit" class="btn allbtn" style="" name="" >
    </form>
      </center>
    </div>
   </div>
{% endblock body-content %}

{% block javascript-code %}
 <!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script> -->

 <script>
 	$('#id_usernm').change(function() {
 		const url = $('#personForm').attr("data-names-url");
 		const parentId = $(this).val();

 		 $.ajax({
 		 	url: url,
 		 	data: {
 		 		'usernmId': parentId
 		 	},
 		 	success: function (data){
        var j;
        var project_manager = [];
        var web_developer = [];
        var tech_lead = [];
        var cheif_technical_officer = [];

        for (j = 0; j < data.length; j++) {
            if (data[j]["designation"] == "Project Manager") {
                project_manager.push(data[j]);
            } else if (data[j]["designation"] == "Tech Leader") {
                tech_lead.push(data[j]);
            }else if (data[j]["designation"] == "Cheif Technical Officer"){
                cheif_technical_officer.push(data[j]);
            } else {
                web_developer.push(data[j]);
            }
        }

        html="<optgroup label=Cheif Technical Officer>";
        for(j = 0; j < cheif_technical_officer.length; j++) {
          html+="<option value=" + cheif_technical_officer[j]["id"] + " name=option-value>" + 
          cheif_technical_officer[j]["first_name"] + cheif_technical_officer[j]["last_name"] + "</option></optgroup>"
        }
        html+="<optgroup label=Project Manager>";
        for(j = 0; j < project_manager.length; j++) {
          html+="<option value="+project_manager[j]["id"]+" name=option-value>"+project_manager[j]
                ["first_name"]+ project_manager[j]["last_name"]+"</option></optgroup>"
        }
        html+="<optgroup label=Tech Leader>";
        for(j = 0; j < tech_lead.length; j++) {
          html+="<option value="+tech_lead[j]["id"]+" name=option-value>"+tech_lead[j]
                ["first_name"]+ tech_lead[j]["last_name"]+"</option></optgroup>"
        }
        html+="<optgroup label=Web_Developer>";
        for(j = 0; j < web_developer.length; j++) {
          html+="<option value="+web_developer[j]["id"]+" name=option-value>"+web_developer[j]
                ["first_name"]+ web_developer[j]["last_name"]+"</option></optgroup>"
        }
        
 		 		$('#id_child').html(html);
 		 	}
 		 });
 	});
 </script>
{% endblock javascript-code %}
